{
  "description": "MQTT client",
  "module": "mqttclient.js",
  "params": [
    {
      "name": "host",
      "note": "A IP adress of MQTT broker",
      "type": "string",
      "val": "127.0.0.1"
    },
    {
      "name": "port",
      "note": "A port of MQTT broker",
      "type": "number",
      "val": "1883"
    },
    {
      "name": "timeout",
      "note": "A reconnection to broker timeout in seconds",
      "type": "number",
      "val": "1"
    },
    {
      "name": "integration_period",
      "note": "Period of intergration in seconds",
      "type": "number",
      "val": "1"
    },
    {
      "name": "client_id",
      "note": "MQTT client ID, max: 23 char.",
      "type": "string",
      "val": "intraclient1"
    },
    {
      "name": "scheme",
      "note": "MQTT schema for connection",
      "type": "string",
      "val": "tcp"
    },
    {
      "name": "use_password",
      "note": "Is MQTT brocker using login and password for connection",
      "type": "cb",
      "val": "true"
    },
    {
      "name": "login",
      "note": "Login for MQTT brocker",
      "type": "string",
      "val": "login"
    },
    {
      "name": "password",
      "note": "Password for MQTT brocker",
      "type": "string",
      "val": "password"
    }
  ],

  "chpattern": [
    {
      "name": "desc",
      "note": "Тип канала",
      "type": "droplist",
      "data": [
        { "id": "DI", "name": "DI - Digital Input" },
        { "id": "DO", "name": "DO - Digital Output" },
        { "id": "AI", "name": "AI - Analog Input" },
        { "id": "AO", "name": "AO - Analog Output (PWM)" },
        { "id": "Meter", "name": "Meter - (IN)" }
      ]
    },

    { "name": "topic", "note": "Topic - состояние", "type": "STRING" },

    {
      "name": "actions",
      "tabnote": "Исходящие команды",
      "note": "Команда",
      "type": "multi",
      "visible": "data.desc == \"DO\" || data.desc == \"AO\"",
      "data": {
        "scheme": {
          "act": { "name": "Команда", "type": "droplist", "order": 0, "data":[{"id":"on", "name":"on"}, {"id":"off", "name":"off"},{"id":"toggle", "name":"toggle"}] },
          "topic": { "name": "Topic", "type": "STRING", "order": 1 },
          "message": { "name": "Message", "type": "STRING", "order": 2 }
        },
        "default": {
          "act": "on",
          "topic": "/devices/${dn}/command",
          "message": "on"
        }
      }
    }
  ],

  "chdefault": {
    "chan": 1,
    "desc": "DI",
    "topic": "/devices/dd1",
    "dn": "",
    "actions": [
      { "act": "on", "topic": "/devices/${dn}/command", "message": "on" },
      { "act": "off", "topic": "/devices/${dn}/command", "message": "off" }
    ]
  },

  "genrules": {
    "AI": { "cl": "SensorA" },
    "AO": { "cl": "ActorA" },
    "DI": { "cl": "SensorD" },
    "DO": { "cl": "ActorD" },
    "Meter": { "cl": "Meter" }
  },

  "extrapattern": [
    {
        "name": "desc",
        "note": "Тип канала",
        "type": "droplist",
        "data": [
          { "id": "DI", "name": "DI - Digital Input" },
          { "id": "DO", "name": "DO - Digital Output" },
          { "id": "AI", "name": "AI - Analog Input" },
          { "id": "AO", "name": "AO - Analog Output (PWM)" },
          { "id": "Meter", "name": "Meter - (IN)" }
        ]
      },

    {
      "name": "dn",
      "note": "Устройство для публикации",
      "type": "autocomplete",
      "data": "devicesdroplist"
    },
    {
      "name": "topic",
      "note": "Топик - публикация состояния",
      "type": "string"
    },
    {
      "name": "calc",
      "note": "Формула для payload",
      "type": "string"
    },
    {
      "name": "actions",
      "tabnote": "Входящие команды",
      "note": "Команда",
      "type": "multi",
      "visible": "data.desc == \"DO\" || data.desc == \"AO\"",
      "data": {
        "scheme": {
         
          "topic": { "name": "Topic", "type": "STRING", "order": 1 },
          "message": { "name": "Сообщение", "type": "STRING", "order": 2 },
          "act": { "name": "Выполнить команду", "type": "STRING", "order": 0 }
        },
        "default": {
          "act": "on",
          "topic": "/devices/${dn}/command",
          "message": "on"
        }
      }
    }
  ],
  "extradefault": {
    "desc":"DI",  
    "dn": "",
    "topic": "/devices/${dn}",
    "calc": "",
    "actions": [
      { "act": "on", "topic": "/devices/${dn}/command", "message": "on" },
      { "act": "off", "topic": "/devices/${dn}/command", "message": "off" }
    ]
  },

  "actions": [{}]
}
